# Bing to Qwen AI Search 插件

这是一个 Microsoft Edge 浏览器插件，可以在 Bing 搜索时自动在 Qwen AI 上执行相同搜索，并将结果展示在 Bing 页面上。

## 功能说明

1. 当用户访问 cn.bing.com 并搜索内容时自动检测搜索关键词
2. 获取 Bing 的搜索内容
3. 后台访问 chat.qwen.ai
4. 自动点击 Qwen AI 页面上的"搜索"按钮
5. 在 Qwen AI 的聊天输入框中输入搜索内容
6. 点击发送按钮获取 AI 回复
7. 将 AI 回复的内容显示在 cn.bing.com 的主菜单和搜索结果之间
8. 提供"打开原页面"按钮，可以查看完整的 Qwen AI 页面内容

## 安装方法

1. 打开 Microsoft Edge 浏览器
2. 进入 `edge://extensions/`
3. 打开右上角的"开发者模式"
4. 点击"加载解压缩的扩展"按钮
5. 选择本项目文件夹
6. 插件安装完成

## 使用方法

1. 安装插件后，在 Bing (cn.bing.com) 上进行任何搜索
2. 插件会在发送请求前在页面上显示"加载中..."状态
3. 插件会自动在后台访问 Qwen AI 并执行相同搜索
4. Qwen AI 的回复将显示在 Bing 搜索结果页面的主菜单和搜索结果之间
5. 可以点击"关闭"按钮隐藏回复内容
6. 点击"打开原页面"按钮可以查看完整的 Qwen AI 页面内容
7. 通过点击插件图标可以启用/禁用插件功能

## 文件说明

- `manifest.json`: 插件配置文件
- `content.js`: 内容脚本，用于在 Bing 页面上检测搜索并显示结果
- `background.js`: 后台脚本，处理搜索逻辑并与 Qwen AI 交互
- `styles.css`: 样式文件，美化显示效果
- `popup.html`: 弹出页面
- `popup.js`: 弹出页面脚本
- `icon.svg`: 插件图标

## 工作原理

1. 当用户在 Bing 上进行搜索时，content.js 会检测到搜索关键词
2. content.js 在发送请求前先显示"加载中..."状态
3. content.js 将搜索关键词发送给 background.js
4. background.js 创建一个隐藏窗口访问 Qwen AI
5. 在 Qwen AI 页面上，插件会：
   - 点击搜索按钮
   - 在输入框中输入 Bing 的搜索关键词
   - 点击发送按钮
   - 等待 AI 回复
   - 提取回复内容
6. background.js 将回复内容发送回 Bing 页面
7. content.js 更新之前显示的容器，将"加载中..."替换为实际的 AI 回复
8. 用户点击"打开原页面"按钮时，会在新标签页中打开后台访问的完整 Qwen AI 页面

## 回复内容显示位置

插件将 Qwen AI 的回复显示在 Bing 页面的主菜单和搜索结果之间。这是通过以下方式实现的：

1. 查找页面中的 `#b_header` 元素（主菜单）
2. 查找页面中的 `#b_results` 元素（搜索结果）
3. 将回复容器插入到这两个元素之间

如果无法找到这些元素或插入失败，则会将回复显示在页面顶部。

## 回复内容提取说明

插件通过多种方式尝试提取 Qwen AI 的回复内容：

1. 首先查找包含 "response-content" 或 "content-container" 类名的元素
2. 如果找不到特定容器，则查找包含 "message" 的元素
3. 如果仍然找不到，则获取页面上的文本内容

这种方法可以适应 Qwen AI 网站结构的变化。

## 隐式访问说明

由于浏览器安全限制，我们无法在不打开网页的情况下直接访问 Qwen AI。不过，插件采用了以下策略来实现尽可能隐式的访问：

1. 在后台创建一个隐藏窗口来加载 Qwen AI 页面
2. 窗口不会获得焦点，也不会干扰用户当前的操作
3. 完成操作后尽快关闭窗口，减少对用户的影响

## 错误处理

插件包含多种错误处理机制：

1. DOM 操作错误处理：当尝试插入元素失败时，会回退到其他插入方式
2. 消息传递错误处理：避免在连接关闭后尝试发送响应
3. 元素查找错误处理：当无法找到特定元素时，使用备选方案

## 如何查看日志

### 查看后台脚本日志 (background.js)
1. 打开 Edge 浏览器
2. 访问 `edge://extensions/`
3. 找到 "Bing to Qwen AI Search" 插件
4. 点击 "检查视图" 下的 "background.js" 链接
5. 在打开的开发者工具中查看 Console 标签页中的日志

### 查看内容脚本日志 (content.js)
1. 打开 Bing 网站 (cn.bing.com)
2. 进行搜索操作
3. 按 F12 打开开发者工具
4. 查看 Console 标签页中的日志

### 查看弹出页面日志 (popup.js)
1. 点击浏览器工具栏中的插件图标
2. 在弹出页面中按 F12 打开开发者工具
3. 查看 Console 标签页中的日志

## 常见问题及解决方案

### 1. "A listener indicated an asynchronous response by returning true, but the message channel closed before a response was received"
这是由于消息监听器返回了 true 表示异步响应，但在发送响应之前连接已关闭。我们已经修复了这个问题，确保只在需要异步响应时才返回 true。

### 2. "Failed to execute 'insertBefore' on 'Node': The node before which the new node is to be inserted is not a child of this node"
这是由于尝试将元素插入到不正确的父节点中。我们已经添加了错误处理机制，当插入失败时会回退到其他方式。

### 3. 未能获取到 AI 回复
这可能是由于以下原因：
- Qwen AI 网站结构变化，导致无法找到正确的按钮和输入框
- 网络连接问题
- 页面加载时间不足

可以通过查看日志来确定具体原因。

## 注意事项

1. 插件需要网络连接才能正常工作
2. 由于需要与 Qwen AI 页面交互，首次运行可能需要一些时间
3. 如果 Qwen AI 页面结构发生变化，可能需要更新选择器
4. 插件可能会受到网站安全策略的影响
5. 为了获得最佳体验，请确保可以访问 chat.qwen.ai

## 故障排除

如果插件不能正常工作，请尝试以下步骤：

1. 确保插件已启用
2. 检查是否给予了必要的权限
3. 刷新 Bing 页面
4. 检查浏览器控制台是否有错误信息
5. 确认 Qwen AI 网站可以正常访问
6. 检查网络连接是否正常

## 更新日志

### v1.0
- 初始版本发布
- 解决了图标文件缺失导致的加载错误问题
- 增强了日志记录功能，便于调试
- 修复了异步消息处理问题
- 优化了 Qwen AI 访问方式，使用隐藏窗口减少对用户干扰
- 改进了回复内容提取逻辑
- 将回复显示位置调整到主菜单和搜索结果之间
- 在发送请求前显示加载状态
- 添加了 DOM 操作错误处理机制

## 支持

如遇到问题，请提交 issue 或联系开发者。

# Intelligence-Bing

一个在必应搜索结果页面中集成 Qwen AI 回复的浏览器扩展。

## 功能

1. 在必应搜索结果页面中自动检测搜索查询
2. 在后台打开 Qwen AI 页面并获取回复
3. 在必应搜索结果页面上显示 Qwen AI 的回复
4. 在发送请求前就在页面上显示加载状态，提升用户体验
5. 提供"打开原页面"按钮，可以打开后台访问的 Qwen AI 页面
6. 当 Qwen AI 要求验证时，自动嵌入验证卡片到页面中

## 安装

1. 打开 Edge 浏览器
2. 进入 `edge://extensions/`
3. 打开"开发者模式"
4. 点击"加载解压缩的扩展"
5. 选择本项目文件夹

## 使用方法

1. 安装扩展后，在必应搜索任何内容
2. 扩展会自动在搜索结果页面上显示 Qwen AI 的回复
3. 点击"关闭"按钮可以关闭回复框
4. 点击"打开原页面"按钮可以查看后台访问的完整 Qwen AI 页面
5. 如果 Qwen AI 要求验证，扩展会自动嵌入验证卡片到页面中，用户可以直接在必应页面上完成验证

## 文件说明

- `manifest.json`: 扩展的配置文件
- `content.js`: 在必应页面上运行的脚本，用于检测搜索和显示回复
- `background.js`: 后台脚本，用于在后台打开 Qwen AI 页面并提取回复
- `popup.html`: 扩展弹出页面的 HTML
- `popup.js`: 扩展弹出页面的 JavaScript
- `styles.css`: 扩展的样式文件
- `icon.svg`: 扩展的图标文件

## 工作原理

1. `content.js` 检测必应搜索页面的查询参数
2. 将查询发送到 `background.js`
3. `background.js` 在隐藏窗口中打开 Qwen AI 页面
4. 提取 Qwen AI 的回复内容
5. 将回复内容发送回 `content.js`
6. `content.js` 在必应页面上显示回复
7. 用户可以点击"打开原页面"按钮查看完整的 Qwen AI 页面

## 注意事项

- 扩展需要网络连接以访问 Qwen AI 页面
- 由于需要在后台加载页面，回复可能需要几秒钟时间
- 如果 Qwen AI 页面结构发生变化，可能需要更新内容提取逻辑
- 当 Qwen AI 要求验证时，扩展会自动嵌入验证卡片到页面中，用户可以直接完成验证
